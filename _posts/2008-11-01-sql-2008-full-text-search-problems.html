---
layout: post
title: SQL 2008 Full-Text Search Problems
date: 2008-11-01 14:11:53.000000000 -04:00
categories:
- server
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _podPressPostSpecific: a:6:{s:15:"itunes:subtitle";s:15:"##PostExcerpt##";s:14:"itunes:summary";s:15:"##PostExcerpt##";s:15:"itunes:keywords";s:17:"##WordPressCats##";s:13:"itunes:author";s:10:"##Global##";s:15:"itunes:explicit";s:2:"No";s:12:"itunes:block";s:2:"No";}
author:
  login: admin
  email: jatwood@codinghorror.com
  display_name: Jeff Atwood
  first_name: Jeff
  last_name: Atwood

---
<p>
You may have noticed that things have been less responsive than usual on stackoverflow.com. The culprit is SQL Server 2008 full-text search. I'll let <a href="http://www.brentozar.com/">Brent</a> explain:</p>
<blockquote><p>
<b>Before 2008, full text search wasn't inside the database - it wasn't subject to things like transactions.</b>  Heck, it was more like Lucene where it lived outside on its own.  Now, it's stored inside data files and it's subject to transactions.  From what im hearing, blocking and locking is a completely new issue in 2008 FTS.  There's a big overhead involved with making it subject to transactions.</p>
<p>
In most environments, you don't see full text being used for transactions.  At StackOverflow, you're doing heavy transactional activity on the same fields that you're doing analytical, many-record selects.</p>
<p>
If you do a full text search on Revisions and you include a common keyword like, say, SQL, you're going to match tens of thousands of records.  When I look at the query plans for these, I'm seeing 50-100k reads.  Doing that inside a table that's also getting heavy inserts - boom, transactional disaster.</p>
</blockquote>
<p>
<b>We rely <i>heavily</i> on full-text search on stackoverflow.com</b>, which worked amazingly well for us under SQL Server 2005. Looks like that's no longer the case for SQL Server 2008, unfortunately.</p>
<p>
Brent is following up with the SQL Server team on this, and they have a copy of our database to test against. (Brent has given so incredibly generously of his time on the database front that I'm adding him to the stackoverflow.com virtual team -- he'll get a place on the About page with the rest of the team.) Based on the stunningly poor SQL Server 2008 full text results so far, and the apparent architecture changes, I'm pessimistic that the SQL team will be able to do anything for us.</p>
<p>
We had always planned to move to <a href="http://incubator.apache.org/lucene.net/">lucene.net</a> in the future; looks like we'll need to move that timetable up aggressively. I'll see what I can do over the weekend to make that happen.</p>
<p /></p></p>
