---
layout: post
title: Three Markdown Gotchas
date: 2008-06-24 22:24:08.000000000 -04:00
categories:
- design
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _podPressPostSpecific: a:6:{s:15:"itunes:subtitle";s:15:"##PostExcerpt##";s:14:"itunes:summary";s:15:"##PostExcerpt##";s:15:"itunes:keywords";s:17:"##WordPressCats##";s:13:"itunes:author";s:10:"##Global##";s:15:"itunes:explicit";s:2:"No";s:12:"itunes:block";s:2:"No";}
author:
  login: admin
  email: jatwood@codinghorror.com
  display_name: Jeff Atwood
  first_name: Jeff
  last_name: Atwood
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>
I've enjoyed working with the excellent WMD "what you see is what you mean"  <a href="http://blog.stackoverflow.com/2008/05/potential-markup-and-editing-choices/">Markdown control</a> while building Stack Overflow. I've been very pleasantly surprised how easy it is to type a smattering of concise <a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a> and generate rather nice-looking content.</p>
<p>
One of Markdown's biggest advantages is its simplicity. Here's a little Markdown test post I've been using that exercises the basic formatting options:</p>
<p><pre>
##Header##

----------

Some **bold** Some *italic* and [a link][1] 

A little code sample

    &lt;/head&gt;
    &lt;title&gt;Web Page Title&lt;/title&gt;
    &lt;/head&gt;

A picture

![alt text][2]

A list

- apples
- oranges
- eggs

A numbered list

1. a
2. b
3. c

A little quote

&gt; It is now time for all good men to come to the aid of their country. 

A final paragraph.

  [1]: http://www.google.com
  [2]: http://www.google.com/intl/en_ALL/images/logo.gif
</pre>
<p>
However, I've also noticed <b>there are a few edge cases where Markdown syntax can get weird and produce unexpected results</b>. </p>
<p>
I started to wonder if there were other edge conditions in advanced Markdown syntax I should know about. I figured John Fraser of <a href="http://attacklab.net/">AttackLab</a>, the author of the WMD control, would be the best person to ask. He was kind enough to respond in some detail, and granted permission for me to repost his thoughts, where he outlines three gotchas to worry about when using Markdown:</p>
<blockquote><p>
<b>1) Markdown's single biggest flaw is its intra-word emphasis.</b></p>
<p>
I don't think anybody writes:</p>
<p>
<code>un*fricking*believable</code></p>
<p>
often enough to justify making it nearly impossible to talk about tokens with underscores in them:</p>
<p>
<code>some_file_name</code></p>
<p>
is interpreted as:</p>
<p>
<code>some&lt;em&gt;file&lt;/em&gt;name</code></p>
<p>
It even works across word boundaries:</p>
<p>
<code>file_one and file_two</code></p>
<p>
becomes:</p>
<p>
<code>file&lt;em&gt;one and file&lt;/em&gt; two</code></p>
<p>
Whenever you're writing tokens with underscores you have to make absolutely sure you're in a `code span`. The same problem will also nail you on equations like a*b*c, but that seems to pop up less frequently.</p>
<p>
Showdown follows the reference implementation on all this, but in WMD I do a little preprocessing to hack the idiocy away: basically I just backslash-escape any underscores or asterisks that might trigger it.  It's a flagrant violation of the standard, but since it's a pre-pass that should produce identical output with any Markdown processor, I feel justified.  Unfortunately my hack did screw up one edge case (which I don't have in front of me) and there isn't any way to disable it.  Both those things will change in the next release.</p>
<p>
<b>2) List items only nest if they cross a magical four-character boundary</b>.</p>
<p>
So:</p></p>
<pre style="border-top:none; border-bottom:none;">
- level 1
  - level 2
    - level 3
      - level 4
        - level 5
          - level 6
</pre>
<p>
is interpreted as:</p></p>
<pre style="border-top:none; border-bottom:none;">
- level 1
    - level 2
    - level 2
        - level 3
        - level 3
            - level 4
</pre>
<p>
Which can be pretty surprising to humans.  I've suggested an alternative algorithm a <a href="http://six.pairlist.net/pipermail/markdown-discuss/2007-July/000690.html">couple</a> of <a href="http://six.pairlist.net/pipermail/markdown-discuss/2008-March/001076.html">times</a> but it looks like neither of the big implementors is interested. (The mailing list's HTML archive strips the whitespace from that first link; do "View Source" to make it make sense.)</p>
<p>
<b>3) Mixing HTML and Markdown has a couple of serious limitations.</b></p>
<p>
You can put Markdown within inline elements:</p></p>
<pre style="border-top:none; border-bottom:none;">
&lt;span&gt;This *will* work.&lt;/span&gt;
</pre>
<p>
but not within block elements:</p></p>
<pre style="border-top:none; border-bottom:none;">
&lt;div&gt;
  This *won't* work.
&lt;/div&gt;
</pre>
<p>
I think this is a symptom of Markdown's being designed for blog posts.  You can paste in big chunks of foreign HTML verbatim without having to double-check them, but it's pretty much impossible to write whole pages in Markdown. Again Gruber's <a href="http://six.pairlist.net/pipermail/markdown-discuss/2007-March/000569.html">not interested</a>; dunno about Fortin.</p>
<p>
In my mind, this last one is huge.  If we allowed Markdown within block-level HTML, we could write a non-lossy version of <a href="http://www.aaronsw.com/2002/html2text/">html2text</a> and make my dream of Markdown as a transient editing format a reality.</p>
<p>
Oh, also?  The HTML parser is pretty broken, so what gets recognized as a complete block of HTML can sometimes be surprising.  But Showdown uses an older, even-more-broken algorithm than the latest Markdown.pl beta, so I probably shouldn't point fingers.</p>
</blockquote>
<p>
Remember, if you don't like Markdown, you can always fall back to HTML -- at least the whitelisted HTML. And if you're curious about how any of this works I strongly encourage you to head over to the <a href="http://wmd-editor.com/examples/splitscreen">WMD advanced demo sandbox</a> and <b>try it out for yourself</b>.</p>
<p /></p></p></p>
