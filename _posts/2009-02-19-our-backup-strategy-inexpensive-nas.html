---
layout: post
title: Our Backup Strategy - Inexpensive NAS
date: 2009-02-19 17:51:03.000000000 -05:00
categories:
- server
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _wp_old_slug: our-backup-strategy-inexpensive-nas-qnap-409u
  _podPressPostSpecific: a:6:{s:15:"itunes:subtitle";s:15:"##PostExcerpt##";s:14:"itunes:summary";s:15:"##PostExcerpt##";s:15:"itunes:keywords";s:17:"##WordPressCats##";s:13:"itunes:author";s:10:"##Global##";s:15:"itunes:explicit";s:2:"No";s:12:"itunes:block";s:2:"No";}
author:
  login: admin
  email: jatwood@codinghorror.com
  display_name: Jeff Atwood
  first_name: Jeff
  last_name: Atwood

---
<p>
As part of our new backup strategy, I decided to invest in an inexpensive Network Attached Storage (NAS) unit -- the <a href="http://www.qnap.com/pro_detail_feature.asp?p_id=103">QNAP TS-409U</a>.</p>
<p>
<a href="http://www.amazon.com/dp/B001AXCJVE/?tag=codinghorror-20" style="border-bottom:none;"><img src="{{ site.baseurl }}/assets/qnap-409u.jpg" border="0" alt="qnap 409u" title="qnap-409u" /></a></p>
<p>
The TS-409U has the following specs:</p>
<ul>
<li>1u rack mountable
</li>
<li>4 SATA drive bays
</li>
<li>500 MHz embedded CPU, 8 MB flash RAM, 512 MB RAM, Linux based
</li>
<li>Supports RAID 0, 1, 5, 6 with hot-plugging drives
</li>
<li>Gigabit ethernet network interface w/ web UI
</li>
<li>Mac, Windows, Linux filesystem support
</li>
</ul>
<p>
Being Linux, you can also do <a href="http://www.qnap.com/pro_features.asp">lots of other cool stuff</a> on it, like run Apache+PHP, MySQL server, FTP server, BitTorrent server, Multimedia Server (whatever the heck <a href="http://www.twonkymedia.com/learn.html">Twonky</a> is), and iTunes compatible media sharing. But for our purposes, it's an inexpensive RAID-based filesystem. It's a minimalistic set of hardware, as you can see in <a href="http://www.techwarelabs.com/reviews/servers/qnap_ts_409u_turbo_nas/index_2.shtml">this Techware Labs review</a>:</p>
<p>
<a href="http://www.techwarelabs.com/reviews/servers/qnap_ts_409u_turbo_nas/index_2.shtml" style="border-bottom:none;"><img src="{{ site.baseurl }}/assets/ts409u-internals.jpg" alt="ts409u-internals" title="ts409u-internals" border="0" /></a></p>
<p>
I populated our TS-409U with four of the best price/capacity hard drives I could source. As of today, at least, the sweet spot is <b>640 GB drives</b>. Total price was $799 for the device, and $60 each for the drives, so around $1,200 total with tax and shipping. </p>
<p>
Our Database Ninja<sup>tm</sup>, <a href="http://www.brentozar.com/">Brent Ozar</a>, gave me a little flak for investing in such a low-end NAS device. It's true, for around $1,400 I could have built yet another quad-core, 2 drive mirror Lenovo RS110 server. However, I felt that having an embedded device <i>dedicated</i> to backups -- and one with <b>four drive bays</b> that can do <a href="http://blog.stackoverflow.com/2009/01/furtheradventures-of-a-raid-noob/">better than RAID 0 or 1</a> -- was the more logical choice. But I agree, it would have been nice to have another full-blown server to pinch hit for scalability or anything else. It's a grey area.</p>
<p>
As for setting up the QNAP TS-409U, I was a little annoyed that you have to run a Windows or Mac executable for the initial setup, instead of just booting it and configuring everything through the comprehensive (and very nice) web UI. But it detected my drives and configured OK, at which point I could use the web UI for everything else: </p>
<p>
<img src="{{ site.baseurl }}/assets/ts409u-sata-config.png" alt="ts409u-sata-config" title="ts409u-sata-config" /></p>
<p>
Seventeen (!) hours later, the array was fully synced and ready for benchmarking. <a href="http://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_6">RAID 6</a> is just like RAID 5, but with one more parity block, so it can <b>survive two drive failures instead of just one</b>.</p>
<p>
<a href="http://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_6" style="border-bottom:none;"><img src="{{ site.baseurl }}/assets/raid-6-diagram.png" border="0" alt="raid-6-diagram" title="raid-6-diagram" class="alignnone size-full wp-image-702" /></a></p>
<p>
The downside of picking a low end NAS is speed. The relatively anemic 500 MHz embedded CPU, combined with software-only RAID and the inherent write penalty of RAID 6's dual parity calculation, means ... <b>well, this is not what I would call a "fast device"</b>. Here are some quick benchmarks I ran:</p>
<table width="400">
<tr>
<td colspan="2"><b>1 file; 6.06 GB</b></td>
</tr>
<tr>
<td>read</td>
<td>21.0 MB/sec</td>
</tr>
<tr>
<td>write</td>
<td>7.62 MB/sec</td>
</tr>
<tr>
<td colspan="2" /></tr>
<tr>
<td colspan="2"><b>5,784 files; 1,114 folders; 355 MB</b></td>
</tr>
<tr>
<td>read</td>
<td>2.46 MB/sec</td>
</tr>
<tr>
<td>write</td>
<td>1.81 MB/sec</td>
</tr>
</table>
<p>
For our intended use, storing a bunch of large single file daily database backups, blazing speed isn't particularly important. Now that we have a 1+ TB backup device on the local network, we can store a huge history of daily backups. These check in at about 5GB per day currently, with a growth rate of 50 - 100 MB per day. This also takes some write pressure off the database server, since whatever backups we take will be spooled to the NAS over ethernet.</p>
<p>
We plan to complement our onsite daily backups with informal offsite <a href="http://en.wikipedia.org/wiki/Sneakernet">"sneakernet"</a> backups. As I've mentioned before, we are fortunate to have Stack Overflow team member Geoff Dalgas live about a mile from the data center. We bought him a 500 GB 2.5" USB drive, so he can head over the data center every 2 months or so and copy some backups off to keep in the (hopefully) unlikely event something terrible happens to <a href="http://blog.stackoverflow.com/2009/02/new-datacenter-migration/">our data center</a>.</p>
<p /></p></p></p></p></p></p></p></p>
