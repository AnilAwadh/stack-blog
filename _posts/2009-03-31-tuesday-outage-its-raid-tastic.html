---
layout: post
title: 'Tuesday Outage: It''s RAID-tastic!'
date: 2009-03-31 18:43:32.000000000 -04:00
categories:
- server
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _podPressPostSpecific: a:6:{s:15:"itunes:subtitle";s:15:"##PostExcerpt##";s:14:"itunes:summary";s:15:"##PostExcerpt##";s:15:"itunes:keywords";s:17:"##WordPressCats##";s:13:"itunes:author";s:10:"##Global##";s:15:"itunes:explicit";s:2:"No";s:12:"itunes:block";s:2:"No";}
author:
  login: admin
  email: jatwood@codinghorror.com
  display_name: Jeff Atwood
  first_name: Jeff
  last_name: Atwood
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>
We had a brief outage early Tuesday morning from 3 AM - 5 AM PST, because the database server was doing this: </p>
<p>
<img src="assets/serveraid-8k-error-memory-retention-failure.jpg" alt="serveraid-8k-error-memory-retention-failure" title="serveraid-8k-error-memory-retention-failure" /></p>
<p>
Oh noes! Not ...</p>
<blockquote><p>
!!! CRITICAL ERROR: Memory retention failure, unflushed cache lost !!!
</p></blockquote>
<p>
There are six exclamation points so you know it's serious. Also, you have to press ENTER. Because it's a <i>CRITICAL ERROR !!!</i></p>
<p>
(we didn't know this at the time, we only belatedly found out later -- once Geoff got up in the morning and had time to head down to the data center.)</p>
<p>
One of the <a href="http://blog.stackoverflow.com/2008/12/server-hosting-rent-vs-buy/">pieces of advice I got on server hosting</a> was to have extra servers on hand <i>just in case</i>. We currently have three web tier servers, though we're only using one (and soon two), so one of those was quickly pressed into service as our temporary database server.</p>
<p>
We have a reasonable backup scheme in place using <a href="http://blog.stackoverflow.com/2009/02/our-backup-strategy-inexpensive-nas/">our little NAS</a>; full database backups occur at 2AM, and incremental backups every four hours. This problem happened at 3AM so we did lose about an hour of data. Our apologies for that.</p>
<p>
<b>Our contingency planning isn't what it should be.</b> We went back and forth with the datacenter for a bit trying to figure out what had happened, and that wasn't smooth due to our lack of planning and the late hour (~1 hour). After I realized a quick power cycle wasn't going to fix the issue, I had to reconfigure one of the web servers. This meant downloading the SQL Server 2008 ISO (25 minutes), installing a hotfix and reboot (5 minutes), then completing the installation (20 minutes). I could then, finally, restore the latest backup from 2 AM (10 minutes). So we were down longer than I would've liked.</p>
<p>
What's unnerving about this problem, though, is that the RAID controller on the Lenovo RD120 -- an Adaptec card that has been rebranded the "IBM ServeRaid 8k" -- has had <b>three BIOS updates since I built the machine in late January, with the (then) latest BIOS!</b> The good news is that the <a href="http://www-947.ibm.com/systems/support/supportsite.wss/docdisplay?lndocid=MIGR-5073646&brandind=5000008">latest BIOS for the ServeRaid-8k</a> fixes this specific 'press ENTER' problem, in fact. So Geoff burned it to bootable CD and installed it.</p>
<p>
(On a related note, I discovered that the lower-end <a href="http://www-947.ibm.com/systems/support/supportsite.wss/docdisplay?lndocid=MIGR-5073138&brandind=5000019">LSI 1064e RAID card on our web servers has also had a driver update</a> which fixes the "bluescreen on drive eject" problem I observed while building them -- and assumed was the norm. I guess not.)</p>
<p>
We know why the server didn't come back after the reboot. But <b>we still don't know what <i>triggered</i> this server reboot in the first place.</b> The event logs and SQL logs look clean, with no hints on rebooting. Now, <a href="http://blog.stackoverflow.com/2009/01/new-stack-overflow-servers-ready/">the Adaptec / ServeRaid 8k card has always been a <i>little</i> wonky for us</a>, causing oddball hard drive incompatibilities with its factory shipped BIOS, and leaving us unable to turn write-back caching on without suffering from bizarre I/O pauses under heavy writes even <i>with</i> the (then) absolute latest firmware, bios, and drivers. So I am tempted to blame it, in the absence of any other evidence.</p>
<p>
If I've learned anything from this experience, it is:</p>
<ol>
<li>Never skimp on your RAID controller. Invest in something quality.
</li>
<li>Pick a RAID controller with good community buzz, and a proven track record of support and reliable performance.
</li>
</ol>
<p>
I thought when I bought Lenovo / IBM, I'd be getting decent RAID controllers with the servers. This is at least partially true. Those rebranded entry-level LSI 1064e RAID controllers on the Lenovo RS110 servers have been solid and reliable performers. The fancier Adaptec/ServeRaid 8k RAID controller on the Lenovo RD120 has been ... uh, less so. But at the rate they're releasing new BIOS updates for the ServeRaid 8k, maybe they'll get there eventually? Or at least let us turn write-back caching on without crippling I/O pauses under load? At this point I'll settle for <i>please don't corrupt all our data</i>..</p>
<p /></p></p></p></p></p></p></p>
